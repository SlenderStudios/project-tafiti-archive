
Type.createNamespace('WLQuickApps.Tafiti.Scripting');WLQuickApps.Tafiti.Scripting.Constants=function(){}
WLQuickApps.Tafiti.Scripting.CryptographyManager=function(){}
WLQuickApps.Tafiti.Scripting.CryptographyManager.get_$0=function(){if(!WLQuickApps.Tafiti.Scripting.CryptographyManager.$1){WLQuickApps.Tafiti.Scripting.CryptographyManager.$1={};}return WLQuickApps.Tafiti.Scripting.CryptographyManager.$1;}
WLQuickApps.Tafiti.Scripting.CryptographyManager.getMD5Hash=function(input){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.CryptographyManager.get_$0(),input)){return WLQuickApps.Tafiti.Scripting.CryptographyManager.get_$0()[input];}var $0=1732584193;var $1=4023233417;var $2=2562383102;var $3=271733878;var $4=7;var $5=12;var $6=17;var $7=22;var $8=5;var $9=9;var $A=14;var $B=20;var $C=4;var $D=11;var $E=16;var $F=23;var $10=6;var $11=10;var $12=15;var $13=21;var $14=WLQuickApps.Tafiti.Scripting.CryptographyManager.$4(input);for(var $16=0;$16<$14.length;$16+=16){var $17=$0;var $18=$1;var $19=$2;var $1A=$3;$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($0,$1,$2,$3,$14[$16+0],$4,3614090360);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($3,$0,$1,$2,$14[$16+1],$5,3905402710);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($2,$3,$0,$1,$14[$16+2],$6,606105819);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($1,$2,$3,$0,$14[$16+3],$7,3250441966);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($0,$1,$2,$3,$14[$16+4],$4,4118548399);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($3,$0,$1,$2,$14[$16+5],$5,1200080426);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($2,$3,$0,$1,$14[$16+6],$6,2821735955);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($1,$2,$3,$0,$14[$16+7],$7,4249261313);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($0,$1,$2,$3,$14[$16+8],$4,1770035416);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($3,$0,$1,$2,$14[$16+9],$5,2336552879);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($2,$3,$0,$1,$14[$16+10],$6,4294925233);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($1,$2,$3,$0,$14[$16+11],$7,2304563134);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($0,$1,$2,$3,$14[$16+12],$4,1804603682);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($3,$0,$1,$2,$14[$16+13],$5,4254626195);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($2,$3,$0,$1,$14[$16+14],$6,2792965006);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.FF($1,$2,$3,$0,$14[$16+15],$7,1236535329);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($0,$1,$2,$3,$14[$16+1],$8,4129170786);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($3,$0,$1,$2,$14[$16+6],$9,3225465664);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($2,$3,$0,$1,$14[$16+11],$A,643717713);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($1,$2,$3,$0,$14[$16+0],$B,3921069994);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($0,$1,$2,$3,$14[$16+5],$8,3593408605);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($3,$0,$1,$2,$14[$16+10],$9,38016083);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($2,$3,$0,$1,$14[$16+15],$A,3634488961);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($1,$2,$3,$0,$14[$16+4],$B,3889429448);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($0,$1,$2,$3,$14[$16+9],$8,568446438);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($3,$0,$1,$2,$14[$16+14],$9,3275163606);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($2,$3,$0,$1,$14[$16+3],$A,4107603335);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($1,$2,$3,$0,$14[$16+8],$B,1163531501);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($0,$1,$2,$3,$14[$16+13],$8,2850285829);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($3,$0,$1,$2,$14[$16+2],$9,4243563512);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($2,$3,$0,$1,$14[$16+7],$A,1735328473);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.GG($1,$2,$3,$0,$14[$16+12],$B,2368359562);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($0,$1,$2,$3,$14[$16+5],$C,4294588738);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($3,$0,$1,$2,$14[$16+8],$D,2272392833);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($2,$3,$0,$1,$14[$16+11],$E,1839030562);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($1,$2,$3,$0,$14[$16+14],$F,4259657740);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($0,$1,$2,$3,$14[$16+1],$C,2763975236);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($3,$0,$1,$2,$14[$16+4],$D,1272893353);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($2,$3,$0,$1,$14[$16+7],$E,4139469664);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($1,$2,$3,$0,$14[$16+10],$F,3200236656);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($0,$1,$2,$3,$14[$16+13],$C,681279174);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($3,$0,$1,$2,$14[$16+0],$D,3936430074);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($2,$3,$0,$1,$14[$16+3],$E,3572445317);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($1,$2,$3,$0,$14[$16+6],$F,76029189);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($0,$1,$2,$3,$14[$16+9],$C,3654602809);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($3,$0,$1,$2,$14[$16+12],$D,3873151461);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($2,$3,$0,$1,$14[$16+15],$E,530742520);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.HH($1,$2,$3,$0,$14[$16+2],$F,3299628645);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($0,$1,$2,$3,$14[$16+0],$10,4096336452);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($3,$0,$1,$2,$14[$16+7],$11,1126891415);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($2,$3,$0,$1,$14[$16+14],$12,2878612391);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($1,$2,$3,$0,$14[$16+5],$13,4237533241);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($0,$1,$2,$3,$14[$16+12],$10,1700485571);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($3,$0,$1,$2,$14[$16+3],$11,2399980690);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($2,$3,$0,$1,$14[$16+10],$12,4293915773);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($1,$2,$3,$0,$14[$16+1],$13,2240044497);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($0,$1,$2,$3,$14[$16+8],$10,1873313359);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($3,$0,$1,$2,$14[$16+15],$11,4264355552);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($2,$3,$0,$1,$14[$16+6],$12,2734768916);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($1,$2,$3,$0,$14[$16+13],$13,1309151649);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($0,$1,$2,$3,$14[$16+4],$10,4149444226);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($3,$0,$1,$2,$14[$16+11],$11,3174756917);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($2,$3,$0,$1,$14[$16+2],$12,718787259);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.II($1,$2,$3,$0,$14[$16+9],$13,3951481745);$0=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($0,$17);$1=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($1,$18);$2=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($2,$19);$3=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($3,$1A);}var $15=WLQuickApps.Tafiti.Scripting.CryptographyManager.$5($0)+WLQuickApps.Tafiti.Scripting.CryptographyManager.$5($1)+WLQuickApps.Tafiti.Scripting.CryptographyManager.$5($2)+WLQuickApps.Tafiti.Scripting.CryptographyManager.$5($3);WLQuickApps.Tafiti.Scripting.CryptographyManager.get_$0()[input]=$15;return $15;}
WLQuickApps.Tafiti.Scripting.CryptographyManager.$2=function($p0,$p1){return ($p0<<$p1)|($p0>>>(32-$p1));}
WLQuickApps.Tafiti.Scripting.CryptographyManager.$3=function($p0,$p1){var $0=$p0&1073741824;var $1=$p1&1073741824;var $2=$p0&2147483648;var $3=$p1&2147483648;var $4=($p0&1073741823)+($p1&1073741823);if(($0&$1)){return ($4^2147483648^$2^$3);}if(($0|$1)){if(($4&1073741824)){return ($4^3221225472^$2^$3);}else{return ($4^1073741824^$2^$3);}}else{return ($4^$2^$3);}}
WLQuickApps.Tafiti.Scripting.CryptographyManager.f=function($p0,$p1,$p2){return ($p0&$p1)|((~$p0)&$p2);}
WLQuickApps.Tafiti.Scripting.CryptographyManager.g=function($p0,$p1,$p2){return ($p0&$p2)|($p1&(~$p2));}
WLQuickApps.Tafiti.Scripting.CryptographyManager.h=function($p0,$p1,$p2){return ($p0^$p1^$p2);}
WLQuickApps.Tafiti.Scripting.CryptographyManager.i=function($p0,$p1,$p2){return ($p1^($p0|(~$p2)));}
WLQuickApps.Tafiti.Scripting.CryptographyManager.FF=function($p0,$p1,$p2,$p3,$p4,$p5,$p6){$p0=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($p0,WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.f($p1,$p2,$p3),$p4),$p6));return WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$2($p0,$p5),$p1);}
WLQuickApps.Tafiti.Scripting.CryptographyManager.GG=function($p0,$p1,$p2,$p3,$p4,$p5,$p6){$p0=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($p0,WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.g($p1,$p2,$p3),$p4),$p6));return WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$2($p0,$p5),$p1);}
WLQuickApps.Tafiti.Scripting.CryptographyManager.HH=function($p0,$p1,$p2,$p3,$p4,$p5,$p6){$p0=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($p0,WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.h($p1,$p2,$p3),$p4),$p6));return WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$2($p0,$p5),$p1);}
WLQuickApps.Tafiti.Scripting.CryptographyManager.II=function($p0,$p1,$p2,$p3,$p4,$p5,$p6){$p0=WLQuickApps.Tafiti.Scripting.CryptographyManager.$3($p0,WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.i($p1,$p2,$p3),$p4),$p6));return WLQuickApps.Tafiti.Scripting.CryptographyManager.$3(WLQuickApps.Tafiti.Scripting.CryptographyManager.$2($p0,$p5),$p1);}
WLQuickApps.Tafiti.Scripting.CryptographyManager.$4=function($p0){var $0;var $1=$p0.length;var $2=$1+8;var $3=($2-($2%64))/64;var $4=($3+1)*16;var $5=new Array($4-1);var $6=0;var $7=0;while($7<$1){$0=($7-($7%4))/4;$6=($7%4)*8;$5[$0]=($5[$0]|($p0.charCodeAt($7)<<$6));$7++;}$0=($7-($7%4))/4;$6=($7%4)*8;$5[$0]=($5[$0]|(128<<$6));$5[$4-2]=($1<<3);$5[$4-1]=($1>>29);return $5;}
WLQuickApps.Tafiti.Scripting.CryptographyManager.$5=function($p0){var $0=new StringBuilder();var $1;for(var $2=0;$2<=3;$2++){$1=(($p0>>>($2*8))&255);var $3='0'+$1.toString(16);$0.append($3.substr($3.length-2,2));}return $0.toLocaleString();}
WLQuickApps.Tafiti.Scripting.MessengerManager=function(){}
WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController=function(){return WLQuickApps.Tafiti.Scripting.MessengerManager.$0;}
WLQuickApps.Tafiti.Scripting.MessengerManager.get_isSignedIn=function(){return ((WLQuickApps.Tafiti.Scripting.MessengerManager.$0)&&WLQuickApps.Tafiti.Scripting.MessengerManager.$0.get_isSignedIn());}
WLQuickApps.Tafiti.Scripting.MessengerManager.startMessenger=function(){if(!WLQuickApps.Tafiti.Scripting.MessengerManager.$0){WLQuickApps.Tafiti.Scripting.MessengerManager.$0=new WLQuickApps.Tafiti.Scripting.MessengerController();}}
WLQuickApps.Tafiti.Scripting.MessengerManager.getMessengerContactByEmailHash=function(emailHash){WLQuickApps.Tafiti.Scripting.MessengerManager.$1();var $enum1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_contacts().getEnumerator();while($enum1.moveNext()){var $0=$enum1.get_current();if(WLQuickApps.Tafiti.Scripting.Utilities.hash($0.get_currentAddress().get_address())===emailHash){return $0;}}return null;}
WLQuickApps.Tafiti.Scripting.MessengerManager.supportsTafitiMessages=function(emailHash){var $0=WLQuickApps.Tafiti.Scripting.MessengerManager.getMessengerContactByEmailHash(emailHash);if((!$0)||!$0.get_currentAddress().get_isOnline()){return false;}if(!$0.get_currentAddress().get_capabilities().supportsMessageType(3)){return false;}var $1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_conversations().create($0.get_currentAddress());return $1.supportsApplicationMessageType('tafitiupdate');}
WLQuickApps.Tafiti.Scripting.MessengerManager.sendUpdateMessage=function(emailHash,shelfStack){WLQuickApps.Tafiti.Scripting.MessengerManager.$1();if(WLQuickApps.Tafiti.Scripting.MessengerManager.supportsTafitiMessages(emailHash)){var $0=WLQuickApps.Tafiti.Scripting.MessengerManager.getMessengerContactByEmailHash(emailHash);var $1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_conversations().create($0.get_currentAddress());$1.sendMessage(new WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage(shelfStack.shelfStackID),null);}else{var $2='I have updated the shelf stack \"'+shelfStack.label+'\" at '+WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot();WLQuickApps.Tafiti.Scripting.MessengerManager.sendTextMessage(emailHash,$2);}}
WLQuickApps.Tafiti.Scripting.MessengerManager.sendTextMessage=function(emailHash,message){WLQuickApps.Tafiti.Scripting.MessengerManager.$1();var $0=WLQuickApps.Tafiti.Scripting.MessengerManager.getMessengerContactByEmailHash(emailHash);if((!$0)||!$0.get_currentAddress().get_isOnline()){return;}var $1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_conversations().create($0.get_currentAddress());$1.sendMessage(new Microsoft.Live.Messenger.TextMessage(message,Microsoft.Live.Messenger.TextMessageFormat.get_defaultFormat()),null);}
WLQuickApps.Tafiti.Scripting.MessengerManager.sendShelfStackInvite=function(emailHash,shelfStack){WLQuickApps.Tafiti.Scripting.MessengerManager.$1();var $0='I have invited you to join the shelf stack \"'+shelfStack.label+'\" at '+WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot();var $1=false;var $enum1=shelfStack.get_owners().getEnumerator();while($enum1.moveNext()){var $2=$enum1.get_current();if(!$2.get_isOnline()||$2.get_isLoggedInUser()){continue;}WLQuickApps.Tafiti.Scripting.MessengerManager.sendUpdateMessage(emailHash,shelfStack);}if(WLQuickApps.Tafiti.Scripting.MessengerManager.supportsTafitiMessages(emailHash)){WLQuickApps.Tafiti.Scripting.MessengerManager.sendUpdateMessage(emailHash,shelfStack);}else{WLQuickApps.Tafiti.Scripting.MessengerManager.sendTextMessage(emailHash,$0);}}
WLQuickApps.Tafiti.Scripting.MessengerManager.isContact=function(emailHash){var $enum1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_contacts().getEnumerator();while($enum1.moveNext()){var $0=$enum1.get_current();if(WLQuickApps.Tafiti.Scripting.Utilities.hash($0.get_currentAddress().get_address())===emailHash){return true;}}return false;}
WLQuickApps.Tafiti.Scripting.MessengerManager.getDisplayName=function(emailHash){var $0=WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserByEmailHash(emailHash);if(($0)&&($0.get_messengerAddress())){return $0.get_displayName();}return 'Unknown';}
WLQuickApps.Tafiti.Scripting.MessengerManager.addContact=function(emailHash){var $enum1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_pendingContacts().getEnumerator();while($enum1.moveNext()){var $1=$enum1.get_current();if(WLQuickApps.Tafiti.Scripting.Utilities.hash($1.get_imAddress().get_address())===emailHash){WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().addContact($1.get_imAddress().get_address());return;}}var $enum2=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_conversations().getEnumerator();while($enum2.moveNext()){var $2=$enum2.get_current();var $enum3=$2.get_roster().getEnumerator();while($enum3.moveNext()){var $3=$enum3.get_current();if(WLQuickApps.Tafiti.Scripting.Utilities.hash($3.get_address())===emailHash){WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().addContact($3.get_address());return;}}}var $0=WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserByEmailHash(emailHash);if(($0)&&($0.get_messengerAddress())){WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().addContact($0.get_messengerAddress().get_address());}}
WLQuickApps.Tafiti.Scripting.MessengerManager.$1=function(){if(!WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_isSignedIn()){throw new Error('You must be logged in to messenger to do this');}}
WLQuickApps.Tafiti.Scripting.InteropManager=function(){}
WLQuickApps.Tafiti.Scripting.InteropManager.get_interop=function(){if(!WLQuickApps.Tafiti.Scripting.InteropManager.$0){WLQuickApps.Tafiti.Scripting.InteropManager.$0=new SJ.Interop();}return WLQuickApps.Tafiti.Scripting.InteropManager.$0;}
WLQuickApps.Tafiti.Scripting.InteropManager.updateShelfStack=function(shelfStack){WLQuickApps.Tafiti.Scripting.InteropManager.get_interop().updateShelfStack(shelfStack);}
WLQuickApps.Tafiti.Scripting.InteropManager.popIMConsentDialog=function(pendingShelfStack){WLQuickApps.Tafiti.Scripting.InteropManager.get_interop().popIMConsentDialog(pendingShelfStack);}
WLQuickApps.Tafiti.Scripting.InteropManager.popAcceptContactDialog=function(displayName,emailAddress,inviteMessage){WLQuickApps.Tafiti.Scripting.InteropManager.get_interop().popAcceptContactDialog(displayName,emailAddress,inviteMessage);}
WLQuickApps.Tafiti.Scripting.InteropManager.messengerStatusChanged=function(isSignedIn){WLQuickApps.Tafiti.Scripting.InteropManager.get_interop().messengerStatusChanged(isSignedIn);}
WLQuickApps.Tafiti.Scripting.InteropManager.onIncomingTextMessage=function(emailhash,displayName,messageText){WLQuickApps.Tafiti.Scripting.InteropManager.get_interop().onIncomingTextMessage(emailhash,displayName,messageText);}
WLQuickApps.Tafiti.Scripting.ContactElement=function(contact){this.$0=contact;var $0=WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserByEmailHash(WLQuickApps.Tafiti.Scripting.Utilities.hash(contact.get_currentAddress().get_address()));this.$1=new SJ.ContactVisual($0);this.$0.get_currentAddress().get_presence().add_propertyChanged(Delegate.create(this,this.$2));}
WLQuickApps.Tafiti.Scripting.ContactElement.prototype={$0:null,$1:null,get_emailHash:function(){return WLQuickApps.Tafiti.Scripting.Utilities.hash(this.$0.get_currentAddress().get_address());},remove:function(){this.$1.remove();},$2:function($p0,$p1){if(!String.isNullOrEmpty(this.$0.get_currentAddress().get_presence().get_displayName())){this.$1.displayName=this.$0.get_currentAddress().get_presence().get_displayName();}else{this.$1.displayName=this.$0.get_currentAddress().get_presence().get_imAddress().get_address();}this.$1.isOnline=(this.$0.get_currentAddress().get_presence().get_status());this.$1.updateUI();}}
WLQuickApps.Tafiti.Scripting.TafitiUserManager=function(){}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$0=function(){if(!WLQuickApps.Tafiti.Scripting.TafitiUserManager.$1){WLQuickApps.Tafiti.Scripting.TafitiUserManager.$1={};}return WLQuickApps.Tafiti.Scripting.TafitiUserManager.$1;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$2=function(){if(!WLQuickApps.Tafiti.Scripting.TafitiUserManager.$3){WLQuickApps.Tafiti.Scripting.TafitiUserManager.$3={};}return WLQuickApps.Tafiti.Scripting.TafitiUserManager.$3;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4=function(){if(!WLQuickApps.Tafiti.Scripting.TafitiUserManager.$5){WLQuickApps.Tafiti.Scripting.TafitiUserManager.$5=[];}return WLQuickApps.Tafiti.Scripting.TafitiUserManager.$5;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$6=function(){if(!WLQuickApps.Tafiti.Scripting.TafitiUserManager.$7){WLQuickApps.Tafiti.Scripting.TafitiUserManager.$7=[];}return WLQuickApps.Tafiti.Scripting.TafitiUserManager.$7;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_alwaysSendMessages=function(){if(WLQuickApps.Tafiti.Scripting.TafitiUserManager.$8){return true;}var $0='';var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetAlwaysSendMessages',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);return Boolean.parse($1.responseXML.lastChild.text);}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.set_alwaysSendMessages=function(value){WLQuickApps.Tafiti.Scripting.TafitiUserManager.$8=value;var $0='alwaysSendMessages='+value.toString();var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/SetAlwaysSendMessages',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);return value;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_loggedInUserID=function(){return WLQuickApps.Tafiti.Scripting.TafitiUserManager.$9;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.set_loggedInUserID=function(value){WLQuickApps.Tafiti.Scripting.TafitiUserManager.$9=value;return value;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_loggedInUser=function(){if(!WLQuickApps.Tafiti.Scripting.TafitiUserManager.$9){return null;}return WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUser(WLQuickApps.Tafiti.Scripting.TafitiUserManager.$9);}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.beginUserRequestByUserID=function(userID){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$0(),userID)){return;}var $0='userID='+userID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetUser',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.TafitiUserManager.$A);WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.beginUserRequestByEmailHash=function(emailHash){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$2(),emailHash)){return;}var $0='emailHash='+emailHash;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetUserByEmailHash',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.TafitiUserManager.$A);WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.$A=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().removeAt($0);$0--;var $2=WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser($2);return;}}}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.beginUserListRequestByEmailHash=function(emailHashes){var $0='emailHashes='+emailHashes.join(',');var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetUserListByEmailHash',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.TafitiUserManager.$B);WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.$B=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$4().removeAt($0);$0--;var $2=$1.responseXML.getElementsByTagName('UserData');for(var $3=0;$3<$2.length;$3++){var $4=WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode($2[$3]);WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser($4);}}}}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserListRequestByEmailHash=function(emailHashes){var $0=[];var $enum1=emailHashes.getEnumerator();while($enum1.moveNext()){var $4=$enum1.get_current();if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$2(),$4)){$0.add($4);}}if(!$0.length){return;}var $1='emailHashes='+$0.join(',');var $2=new XMLHttpRequest();$2.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetUserListByEmailHash',false);$2.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$2.setRequestHeader('Content-Length',$1.length.toString());$2.send($1);var $3=$2.responseXML.getElementsByTagName('UserData');for(var $5=0;$5<$3.length;$5++){var $6=WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode($3[$5]);WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser($6);}}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.updateUserDetails=function(displayName,email){var $0='displayName='+escape(displayName)+'&emailHash='+escape(WLQuickApps.Tafiti.Scripting.Utilities.hash(email));var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/UpdateUserDetails',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserByEmailHash=function(emailHash){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$2(),emailHash)){return WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$2()[emailHash];}var $0='emailHash='+emailHash;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetUserByEmailHash',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2;if($1.responseXML.lastChild.text!==''){$2=WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode($1.responseXML.lastChild);}else{$2=new WLQuickApps.Tafiti.Scripting.TafitiUser();$2.emailHash=emailHash;$2.userID=emailHash;}WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser($2);return $2;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUser=function(userID){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$0(),userID)){return WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$0()[userID];}var $0='userID='+userID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetUser',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser($2);return $2;}
WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser=function(tafitiUser){if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$0(),tafitiUser.userID)){WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$0()[tafitiUser.userID]=tafitiUser;WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_$2()[tafitiUser.emailHash]=tafitiUser;}}
WLQuickApps.Tafiti.Scripting.TafitiUpdateMessageFactory=function(){WLQuickApps.Tafiti.Scripting.TafitiUpdateMessageFactory.constructBase(this,[WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser()]);}
WLQuickApps.Tafiti.Scripting.TafitiUpdateMessageFactory.prototype={deserialize:function(sender,id,content){return new WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage(content);},serialize:function(message){return (message).shelfStackID;}}
WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage=function(shelfStackID){WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage.constructBase(this);this.shelfStackID=shelfStackID;}
WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage.prototype={shelfStackID:null,get_id:function(){return 'tafitiupdate';}}
WLQuickApps.Tafiti.Scripting.MessengerController=function(){if(WLQuickApps.Tafiti.Scripting.Utilities.userIsLoggedIn()){this.$2=[];this.$3={};window.attachEvent('onbeforeunload',Delegate.create(this,this.document_Unload));this.$1=new Microsoft.Live.Messenger.UI.SignInControl('signInFrame',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/privacy.html',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/Channel.html','');this.$1.add_authenticationCompleted(Delegate.create(this,this.authenticationCompleted));}}
WLQuickApps.Tafiti.Scripting.MessengerController.prototype={$0:null,$1:null,$2:null,$3:null,get_isSignedIn:function(){return ((this.$0)&&(this.$0.get_address().get_presence().get_status()===1));},get_loggedInUser:function(){return this.$0;},addContact:function(address){this.$0.addContact(address,'I have added you as a contact through Tafiti.',null);},authenticationCompleted:function(sender,e){this.$0=new Microsoft.Live.Messenger.User(e.get_identity());this.$0.add_signInCompleted(Delegate.create(this,this.signInCompleted));this.$0.signIn(null);},signInCompleted:function(sender,e){if(!e.get_resultCode()){this.$0.get_address().get_presence().set_status(1);this.$0.get_presence().add_propertyChanged(Delegate.create(this,this.presencePropertyChanged));var $0=[];var $enum1=this.$0.get_contacts().getEnumerator();while($enum1.moveNext()){var $1=$enum1.get_current();$0.add(WLQuickApps.Tafiti.Scripting.Utilities.hash($1.get_currentAddress().get_address()));}WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserListRequestByEmailHash($0.extract(0));var $enum2=this.$0.get_contacts().getEnumerator();while($enum2.moveNext()){var $2=$enum2.get_current();var $3=WLQuickApps.Tafiti.Scripting.Utilities.hash($2.get_currentAddress().get_address());if(!Object.keyExists(this.$3,$3)){var $4=new WLQuickApps.Tafiti.Scripting.ContactElement($2);this.$2.add($4);this.$3[$3]=$4;}}if(!this.$0.get_messageFactory()){this.$0.set_messageFactory(new WLQuickApps.Tafiti.Scripting.TafitiUpdateMessageFactory());if(!this.$0.get_messageFactory().isRegistered('tafitiupdate')){this.$0.get_messageFactory().register('tafitiupdate');}}this.$0.get_contacts().add_collectionChanged(Delegate.create(this,this.contacts_CollectionChanged));this.$0.add_signOutCompleted(Delegate.create(this,this._localUser_SignOutCompleted));this.$0.get_pendingContacts().add_collectionChanged(Delegate.create(this,this.pendingContacts_CollectionChanged));this.$0.get_conversations().add_collectionChanged(Delegate.create(this,this.conversations_CollectionChanged));WLQuickApps.Tafiti.Scripting.InteropManager.messengerStatusChanged(true);}else{}},pendingContacts_CollectionChanged:function(sender,e){for(var $0=e.get_newStartingIndex();$0<e.get_newItems().length;$0++){var $1=e.get_newItems()[$0];WLQuickApps.Tafiti.Scripting.InteropManager.popAcceptContactDialog($1.get_imAddress().get_presence().get_displayName(),$1.get_imAddress().get_address(),$1.get_inviteMessage());}},document_Unload:function(){if(this.get_isSignedIn()){this.$0.signOut(1,false);}},conversations_CollectionChanged:function(sender,e){for(var $0=0;$0<e.get_newItems().length;$0++){var $1=e.get_newItems()[$0];$1.add_messageReceived(Delegate.create(this,this.conversation_MessageReceived));}},conversation_MessageReceived:function(sender,e){switch(e.get_message().get_type()){case 3:var $0=e.get_message();if($0){WLQuickApps.Tafiti.Scripting.ShelfStackManager.updateShelfStack($0.shelfStackID);}break;case 2:break;case 1:var $1=e.get_message();var $2=$1.get_sender().get_presence().get_displayName();if(String.isNullOrEmpty($2)){$2=$1.get_sender().get_presence().get_imAddress().get_address();}WLQuickApps.Tafiti.Scripting.InteropManager.onIncomingTextMessage(WLQuickApps.Tafiti.Scripting.Utilities.hash($1.get_sender().get_address()),$2,$1.get_text());break;default:throw new Error('Unknown message type');}},contacts_CollectionChanged:function(sender,e){for(var $0=0;$0<e.get_newItems().length;$0++){var $1=e.get_newItems()[$0];var $2=WLQuickApps.Tafiti.Scripting.Utilities.hash($1.get_currentAddress().get_address());var $3=this.$3[$2];if(!$3){$3=new WLQuickApps.Tafiti.Scripting.ContactElement($1);this.$2.add($3);this.$3[$2]=$3;}}},_localUser_SignOutCompleted:function(sender,e){if(this.$0){this.$0.dispose();this.$0=null;}WLQuickApps.Tafiti.Scripting.InteropManager.messengerStatusChanged(false);window.navigate(window.location.href);},presencePropertyChanged:function(sender,e){var $0=sender;if((e.get_propertyName()==='Status')&&($0.get_imAddress().get_address()===this.$0.get_address().get_address())){WLQuickApps.Tafiti.Scripting.InteropManager.messengerStatusChanged(false);}else{WLQuickApps.Tafiti.Scripting.TafitiUserManager.updateUserDetails($0.get_displayName(),$0.get_imAddress().get_address());WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginGetMasterData();}}}
WLQuickApps.Tafiti.Scripting.Comment=function(){}
WLQuickApps.Tafiti.Scripting.Comment.createFromXmlNode=function(node){var $0=new WLQuickApps.Tafiti.Scripting.Comment();for(var $1=0;$1<node.childNodes.length;$1++){var $2=node.childNodes[$1];if(String.isNullOrEmpty($2.baseName)){continue;}switch($2.baseName.toLowerCase()){case 'commentid':$0.commentID=$2.text;break;case 'shelfstackid':$0.shelfStackID=$2.text;break;case 'timestamp':$0.timestamp=new Date($2.text);break;case 'text':$0.text=$2.text;break;case 'userid':$0.$0=$2.text;WLQuickApps.Tafiti.Scripting.TafitiUserManager.beginUserRequestByUserID($0.$0);break;default:break;}}return $0;}
WLQuickApps.Tafiti.Scripting.Comment.prototype={commentID:null,shelfStackID:null,timestamp:null,text:null,get_owner:function(){return WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUser(this.$0);},$0:null}
WLQuickApps.Tafiti.Scripting.CommentManager=function(){}
WLQuickApps.Tafiti.Scripting.CommentManager.get_$0=function(){if(!WLQuickApps.Tafiti.Scripting.CommentManager.$1){WLQuickApps.Tafiti.Scripting.CommentManager.$1={};}return WLQuickApps.Tafiti.Scripting.CommentManager.$1;}
WLQuickApps.Tafiti.Scripting.CommentManager.get_$2=function(){if(!WLQuickApps.Tafiti.Scripting.CommentManager.$3){WLQuickApps.Tafiti.Scripting.CommentManager.$3=[];}return WLQuickApps.Tafiti.Scripting.CommentManager.$3;}
WLQuickApps.Tafiti.Scripting.CommentManager.get_$4=function(){if(!WLQuickApps.Tafiti.Scripting.CommentManager.$5){WLQuickApps.Tafiti.Scripting.CommentManager.$5=[];}return WLQuickApps.Tafiti.Scripting.CommentManager.$5;}
WLQuickApps.Tafiti.Scripting.CommentManager.beginGetCommentsForShelfStack=function(shelfStackID){var $0='shelfStackID='+shelfStackID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetConversation',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.CommentManager.$6);WLQuickApps.Tafiti.Scripting.CommentManager.get_$2().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.CommentManager.$6=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.CommentManager.get_$2().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.CommentManager.get_$2()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.CommentManager.get_$2().removeAt($0);$0--;var $2=$1.responseXML.getElementsByTagName('string');if((!$2)||(($2.length===1)&&($2[0].text===String.Empty))){return;}for(var $3=0;$3<$2.length;$3++){if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.CommentManager.get_$0(),$2[$3].text)){WLQuickApps.Tafiti.Scripting.CommentManager.beginCommentRequest($2[$3].text);}}}}}
WLQuickApps.Tafiti.Scripting.CommentManager.beginCommentRequest=function(commentID){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.CommentManager.get_$0(),commentID)){return;}var $0='commentID='+commentID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetComment',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.CommentManager.$7);WLQuickApps.Tafiti.Scripting.CommentManager.get_$4().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.CommentManager.$7=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.CommentManager.get_$4().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.CommentManager.get_$4()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.CommentManager.get_$4().removeAt($0);$0--;var $2=WLQuickApps.Tafiti.Scripting.Comment.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.CommentManager.get_$0()[$2.commentID]=$2;return;}}}
WLQuickApps.Tafiti.Scripting.CommentManager.getCommentsForShelfStack=function(shelfStackID){var $0='shelfStackID='+shelfStackID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetConversation',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=$1.responseXML.getElementsByTagName('string');if((!$2)||(($2.length===1)&&($2[0].text===String.Empty))){return new Array(0);}var $3=new Array($2.length);for(var $4=0;$4<$2.length;$4++){$3[$4]=WLQuickApps.Tafiti.Scripting.CommentManager.getComment($2[$4].text);}return $3;}
WLQuickApps.Tafiti.Scripting.CommentManager.addComment=function(shelfStackID,text){var $0=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack(shelfStackID);var $1='shelfStackID='+shelfStackID+'&text='+escape(text);var $2=new XMLHttpRequest();$2.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/AddComment',false);$2.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$2.setRequestHeader('Content-Length',$1.length.toString());$2.send($1);WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate($0);}
WLQuickApps.Tafiti.Scripting.CommentManager.getComment=function(commentID){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.CommentManager.get_$0(),commentID)){return WLQuickApps.Tafiti.Scripting.CommentManager.get_$0()[commentID];}var $0='commentID='+commentID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetComment',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.Comment.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.CommentManager.get_$0()[commentID]=$2;return $2;}
WLQuickApps.Tafiti.Scripting.CommentManager.cacheComment=function(comment){if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.CommentManager.get_$0(),comment.commentID)){WLQuickApps.Tafiti.Scripting.CommentManager.get_$0()[comment.commentID]=comment;}}
WLQuickApps.Tafiti.Scripting.TafitiUser=function(){}
WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode=function(node){var $0=new WLQuickApps.Tafiti.Scripting.TafitiUser();for(var $1=0;$1<node.childNodes.length;$1++){var $2=node.childNodes[$1];if(String.isNullOrEmpty($2.baseName)){continue;}switch($2.baseName.toLowerCase()){case 'userid':$0.userID=$2.text;break;case 'displayname':$0.$0=$2.text;break;case 'emailhash':$0.emailHash=$2.text;break;case 'messengerpresenceid':$0.messengerPresenceID=$2.text;break;default:break;}}return $0;}
WLQuickApps.Tafiti.Scripting.TafitiUser.prototype={userID:null,emailHash:null,messengerPresenceID:null,get_displayName:function(){if((this.get_messengerAddress())&&!String.isNullOrEmpty(this.get_messengerAddress().get_presence().get_displayName())){if(!String.isNullOrEmpty(this.get_messengerAddress().get_presence().get_displayName())){return this.get_messengerAddress().get_presence().get_displayName();}return this.get_messengerAddress().get_presence().get_imAddress().get_address();}return this.$0;},$0:null,get_messengerAddress:function(){if(!WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_isSignedIn()){this.$1=null;}if((!this.$1)&&WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_isSignedIn()){if(!String.compare(this.emailHash,WLQuickApps.Tafiti.Scripting.Utilities.hash(WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_address().get_address()),true)){this.$1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_address();}else{var $enum1=WLQuickApps.Tafiti.Scripting.MessengerManager.get_myMessengerController().get_loggedInUser().get_contacts().getEnumerator();while($enum1.moveNext()){var $0=$enum1.get_current();if(!String.compare(this.emailHash,WLQuickApps.Tafiti.Scripting.Utilities.hash($0.get_currentAddress().get_address()),true)){this.$1=$0.get_currentAddress();break;}}}}return this.$1;},$1:null,get_isLoggedInUser:function(){return ((WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_loggedInUser())&&(this.emailHash===WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_loggedInUser().emailHash));},get_isOnline:function(){return ((this.get_messengerAddress())&&this.get_messengerAddress().get_isOnline());}}
WLQuickApps.Tafiti.Scripting.EntryPoint=function(){}
WLQuickApps.Tafiti.Scripting.EntryPoint.main=function(arguments){if(WLQuickApps.Tafiti.Scripting.Utilities.userIsLoggedIn()){WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginGetMasterData();}}
WLQuickApps.Tafiti.Scripting.EntryPoint.start=function(){if(WLQuickApps.Tafiti.Scripting.Utilities.userIsLoggedIn()){WLQuickApps.Tafiti.Scripting.MessengerManager.startMessenger();}}
WLQuickApps.Tafiti.Scripting.ShelfStack=function(){}
WLQuickApps.Tafiti.Scripting.ShelfStack.createFromXmlNode=function(shelfStackNode){var $0=new WLQuickApps.Tafiti.Scripting.ShelfStack();for(var $1=0;$1<shelfStackNode.childNodes.length;$1++){var $2=shelfStackNode.childNodes[$1];if(String.isNullOrEmpty($2.baseName)){continue;}var $3;switch($2.baseName.toLowerCase()){case 'label':$0.label=$2.text;break;case 'shelfstackid':$0.shelfStackID=$2.text;break;case 'lastmodifiedtimestamp':$0.lastModifiedTimestamp=new Date($2.text);break;case 'shelfstackitemids':$3=[];for(var $4=0;$4<$2.childNodes.length;$4++){if(String.isNullOrEmpty($2.childNodes[$4].baseName)){continue;}$3.add(WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStackItem($2.childNodes[$4].text));}$0.shelfStackItems=$3.extract(0,$3.length);break;case 'owneremailhashes':$3=[];for(var $5=0;$5<$2.childNodes.length;$5++){if(String.isNullOrEmpty($2.childNodes[$5].baseName)){continue;}$3.add($2.childNodes[$5].text);WLQuickApps.Tafiti.Scripting.TafitiUserManager.beginUserRequestByEmailHash($2.childNodes[$5].text);}$0.$1=$3.extract(0,$3.length);break;default:break;}}return $0;}
WLQuickApps.Tafiti.Scripting.ShelfStack.prototype={shelfStackID:null,label:null,shelfStackItems:null,get_owners:function(){if(!this.$0){this.$0=new Array(this.$1.length);for(var $0=0;$0<this.$1.length;$0++){this.$0[$0]=WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserByEmailHash(this.$1[$0]);}}return this.$0;},$0:null,$1:null,lastModifiedTimestamp:null,addOwner:function(user){this.$0=this.get_owners().concat([user]);}}
WLQuickApps.Tafiti.Scripting.ShelfStackItem=function(){}
WLQuickApps.Tafiti.Scripting.ShelfStackItem.createFromXmlNode=function(shelfStackItemNode){var $0=new WLQuickApps.Tafiti.Scripting.ShelfStackItem();for(var $1=0;$1<shelfStackItemNode.childNodes.length;$1++){var $2=shelfStackItemNode.childNodes[$1];if(String.isNullOrEmpty($2.baseName)){continue;}switch($2.baseName.toLowerCase()){case 'shelfstackitemid':$0.shelfStackItemID=$2.text;break;case 'shelfstackid':$0.shelfStackID=$2.text;break;case 'domain':$0.domain=$2.text;break;case 'title':$0.title=$2.text;break;case 'description':$0.description=$2.text;break;case 'url':$0.url=$2.text;break;case 'userid':$0.owner=WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUser($2.text);break;case 'timestamp':$0.lastModifiedTimestamp=new Date($2.text);break;case 'imageurl':$0.imageUrl=$2.text;break;case 'source':$0.source=$2.text;break;case 'height':$0.height=$2.text;break;case 'width':$0.width=$2.text;break;default:break;}}return $0;}
WLQuickApps.Tafiti.Scripting.ShelfStackItem.prototype={shelfStackItemID:null,shelfStackID:null,domain:null,title:null,description:null,source:null,imageUrl:null,height:null,width:null,url:null,owner:null,lastModifiedTimestamp:null}
WLQuickApps.Tafiti.Scripting.ShelfStackManager=function(){}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks=function(){if(!WLQuickApps.Tafiti.Scripting.ShelfStackManager.$0){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$0=[];}return WLQuickApps.Tafiti.Scripting.ShelfStackManager.$0;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1=function(){if(!WLQuickApps.Tafiti.Scripting.ShelfStackManager.$2){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$2={};}return WLQuickApps.Tafiti.Scripting.ShelfStackManager.$2;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3=function(){if(!WLQuickApps.Tafiti.Scripting.ShelfStackManager.$4){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$4={};}return WLQuickApps.Tafiti.Scripting.ShelfStackManager.$4;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$5=function(){if(!WLQuickApps.Tafiti.Scripting.ShelfStackManager.$6){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$6=[];}return WLQuickApps.Tafiti.Scripting.ShelfStackManager.$6;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$7=function(){if(!WLQuickApps.Tafiti.Scripting.ShelfStackManager.$8){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$8=[];}return WLQuickApps.Tafiti.Scripting.ShelfStackManager.$8;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$9=function(){if(!WLQuickApps.Tafiti.Scripting.ShelfStackManager.$A){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$A=[];}return WLQuickApps.Tafiti.Scripting.ShelfStackManager.$A;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginGetMasterData=function(){var $0='';var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetMasterData',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.ShelfStackManager.$B);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$5().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.$B=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$5().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$5()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$5().removeAt($0);$0--;var $2=$1.responseXML.getElementsByTagName('UserData');for(var $3=0;$3<$2.length;$3++){var $4=WLQuickApps.Tafiti.Scripting.TafitiUser.createFromXmlNode($2[$3]);WLQuickApps.Tafiti.Scripting.TafitiUserManager.cacheUser($4);}$2=$1.responseXML.getElementsByTagName('CommentData');for(var $5=0;$5<$2.length;$5++){var $6=WLQuickApps.Tafiti.Scripting.Comment.createFromXmlNode($2[$5]);WLQuickApps.Tafiti.Scripting.CommentManager.cacheComment($6);}$2=$1.responseXML.getElementsByTagName('ShelfStackItemData');for(var $7=0;$7<$2.length;$7++){var $8=WLQuickApps.Tafiti.Scripting.ShelfStackItem.createFromXmlNode($2[$7]);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1()[$8.shelfStackItemID]=$8;}$2=$1.responseXML.getElementsByTagName('ShelfStackData');for(var $9=0;$9<$2.length;$9++){var $A=WLQuickApps.Tafiti.Scripting.ShelfStack.createFromXmlNode($2[$9]);var $B=false;for(var $C=0;$C<WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().length;$C++){if($A.shelfStackID===(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks()[$C]).shelfStackID){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks()[$C]=$A;$B=true;break;}}if(!$B){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().add($A);}WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[$A.shelfStackID]=$A;WLQuickApps.Tafiti.Scripting.InteropManager.updateShelfStack($A);}}}}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginAddShelfStack=function(label){var $0='label='+escape(label);var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/AddShelfStack',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.ShelfStackManager.$C);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$7().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.$C=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$7().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$7()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$7().removeAt($0);$0--;var $2=WLQuickApps.Tafiti.Scripting.ShelfStack.createFromXmlNode($1.responseXML.lastChild);var $3=false;for(var $4=0;$4<WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().length;$4++){if($2.shelfStackID===(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks()[$4]).shelfStackID){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks()[$4]=$2;$3=true;break;}}if(!$3){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().add($2);}WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[$2.shelfStackID]=$2;WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate($2);WLQuickApps.Tafiti.Scripting.InteropManager.updateShelfStack($2);}}}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.addShelfStack=function(label){var $0='label='+escape(label);var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/AddShelfStack',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.ShelfStack.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().add($2);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[$2.shelfStackID]=$2;return $2;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.leaveShelfStack=function(shelfStackID){if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3(),shelfStackID)){return;}var $0=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack(shelfStackID);delete WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[shelfStackID];var $1='shelfStackID='+escape(shelfStackID);var $2=new XMLHttpRequest();$2.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/LeaveShelfStack',true);$2.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$2.setRequestHeader('Content-Length',$1.length.toString());$2.send($1);WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate($0);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginAddShelfStackItem=function(shelfStackID,domain,title,description,url,imageUrl,width,height,source){var $0='shelfStackID='+escape(shelfStackID)+'&domain='+escape(domain)+'&title='+escape(title)+'&description='+escape(description)+'&url='+escape(url)+'&imageUrl='+escape(imageUrl)+'&width='+width.toString()+'&height='+height.toString()+'&source='+escape(source);var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/AddShelfStackItem',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.ShelfStackManager.$D);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$9().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.$D=function(){for(var $0=0;$0<WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$9().length;$0++){var $1=WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$9()[$0];if($1.readyState===4){WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$9().removeAt($0);$0--;var $2=WLQuickApps.Tafiti.Scripting.ShelfStackItem.createFromXmlNode($1.responseXML.lastChild);var $3=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack($2.shelfStackID);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1()[$2.shelfStackItemID]=$2;var $4=false;for(var $5=0;$5<$3.shelfStackItems.length;$5++){if($2.shelfStackItemID===$3.shelfStackItems[$5].shelfStackItemID){$3.shelfStackItems[$5]=$2;$4=true;break;}}if(!$4){$3.shelfStackItems=$3.shelfStackItems.concat([$2]);}WLQuickApps.Tafiti.Scripting.InteropManager.updateShelfStack($3);WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate($3);}}}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.addShelfStackItem=function(shelfStackID,domain,title,description,url,imageUrl,width,height,source){var $0='shelfStackID='+escape(shelfStackID)+'&domain='+escape(domain)+'&title='+escape(title)+'&description='+escape(description)+'&url='+escape(url)+'&imageUrl='+escape(imageUrl)+'&width='+width.toString()+'&height='+height.toString()+'&source='+escape(source);var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/AddShelfStackItem',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);WLQuickApps.Tafiti.Scripting.ShelfStackManager.updateShelfStack(shelfStackID);WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate(WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack(shelfStackID));return $1.responseXML.lastChild.text;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.checkForUpdates=function(){var $0='lastUpdate='+escape(WLQuickApps.Tafiti.Scripting.ShelfStackManager.$E.toLocaleString());var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/CheckForUpdates',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);WLQuickApps.Tafiti.Scripting.ShelfStackManager.$E=Date.get_now();return Boolean.parse($1.responseXML.lastChild.text);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginUpdateShelfStack=function(shelfStackID){var $0='shelfStackID='+shelfStackID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetShelfStack',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.onreadystatechange=Delegate.create(null,WLQuickApps.Tafiti.Scripting.ShelfStackManager.$C);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$7().add($1);$1.send($0);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.updateShelfStack=function(shelfStackID){var $0='shelfStackID='+shelfStackID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetShelfStack',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.ShelfStack.createFromXmlNode($1.responseXML.lastChild);if(Object.keyExists(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3(),shelfStackID)){for(var $3=0;$3<WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().length;$3++){var $4=WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks()[$3];if($4.shelfStackID===shelfStackID){WLQuickApps.Tafiti.Scripting.ShelfStackManager.$0[$3]=$2;break;}}}else{WLQuickApps.Tafiti.Scripting.ShelfStackManager.$0.add($2);}WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[shelfStackID]=$2;WLQuickApps.Tafiti.Scripting.InteropManager.updateShelfStack($2);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack=function(shelfStackID){if(Object.keyExists(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3(),shelfStackID)){return WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[shelfStackID];}var $0='shelfStackID='+shelfStackID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetShelfStack',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.ShelfStack.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_myShelfStacks().add($2);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$3()[shelfStackID]=$2;return $2;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStackItem=function(shelfStackItemID){shelfStackItemID=shelfStackItemID.toLowerCase();if(Object.keyExists(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1(),shelfStackItemID)){return WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1()[shelfStackItemID];}var $0='shelfStackItemID='+shelfStackItemID;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/GetShelfStackItem',false);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.ShelfStackItem.createFromXmlNode($1.responseXML.lastChild);WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1()[shelfStackItemID]=$2;return $2;}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.addUserToShelfStack=function(shelfStackID,emailHash){var $0=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack(shelfStackID);var $enum1=$0.get_owners().getEnumerator();while($enum1.moveNext()){var $4=$enum1.get_current();if($4.emailHash===emailHash){return;}}var $1=WLQuickApps.Tafiti.Scripting.TafitiUserManager.getUserByEmailHash(emailHash);var $2='shelfStackID='+shelfStackID+'&emailHash='+emailHash;var $3=new XMLHttpRequest();$3.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/AddUserToShelfStack',false);$3.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$3.setRequestHeader('Content-Length',$2.length.toString());$3.send($2);WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginUpdateShelfStack($0.shelfStackID);WLQuickApps.Tafiti.Scripting.MessengerManager.sendShelfStackInvite(emailHash,$0);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.setShelfStackLabel=function(shelfStackID,label){var $0='shelfStackID='+shelfStackID+'&label='+label;var $1=new XMLHttpRequest();$1.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/SetShelfStackLabel',true);$1.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$1.setRequestHeader('Content-Length',$0.length.toString());$1.send($0);var $2=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack(shelfStackID);WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginUpdateShelfStack(shelfStackID);WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate($2);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.removeShelfStackItem=function(shelfStackItemID){if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1(),shelfStackItemID)){return;}var $0=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStackItem(shelfStackItemID);var $1=WLQuickApps.Tafiti.Scripting.ShelfStackManager.getShelfStack($0.shelfStackID);var $2='shelfStackItemID='+shelfStackItemID;if(!Object.keyExists(WLQuickApps.Tafiti.Scripting.ShelfStackManager.get_$1(),shelfStackItemID)){return;}var $3=new XMLHttpRequest();$3.open('POST',WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot()+'/SiteService.asmx/RemoveShelfStackItem',true);$3.setRequestHeader('Content-Type','application/x-www-form-urlencoded');$3.setRequestHeader('Content-Length',$2.length.toString());$3.send($2);WLQuickApps.Tafiti.Scripting.ShelfStackManager.beginUpdateShelfStack($1.shelfStackID);WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate($1);}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdate=function(shelfStack){var $0=false;var $enum1=shelfStack.get_owners().getEnumerator();while($enum1.moveNext()){var $1=$enum1.get_current();if($1.get_isOnline()&&!$1.get_isLoggedInUser()){$0=true;break;}}if(!$0){return;}if(WLQuickApps.Tafiti.Scripting.TafitiUserManager.get_alwaysSendMessages()){WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdateApproved(shelfStack);}else{WLQuickApps.Tafiti.Scripting.InteropManager.popIMConsentDialog(shelfStack);}}
WLQuickApps.Tafiti.Scripting.ShelfStackManager.sendShelfStackUpdateApproved=function(shelfStack){var $enum1=shelfStack.get_owners().getEnumerator();while($enum1.moveNext()){var $0=$enum1.get_current();if($0.get_isOnline()&&!$0.get_isLoggedInUser()){WLQuickApps.Tafiti.Scripting.MessengerManager.sendUpdateMessage($0.emailHash,shelfStack);}}}
WLQuickApps.Tafiti.Scripting.Utilities=function(){}
WLQuickApps.Tafiti.Scripting.Utilities.createSpan=function(innerText,cssClass){return WLQuickApps.Tafiti.Scripting.Utilities.createNode('span',innerText,cssClass);}
WLQuickApps.Tafiti.Scripting.Utilities.createListItem=function(innerText){return WLQuickApps.Tafiti.Scripting.Utilities.createNode('li',innerText,String.Empty);}
WLQuickApps.Tafiti.Scripting.Utilities.createTertiaryHeader=function(innerText){return WLQuickApps.Tafiti.Scripting.Utilities.createNode('h3',innerText,String.Empty);}
WLQuickApps.Tafiti.Scripting.Utilities.createParagraph=function(innerText){return WLQuickApps.Tafiti.Scripting.Utilities.createNode('p',innerText,String.Empty);}
WLQuickApps.Tafiti.Scripting.Utilities.createNode=function(elementType,innerText,cssClass){var $0=document.createElement(elementType);$0.innerText=innerText;$0.className=cssClass;return $0;}
WLQuickApps.Tafiti.Scripting.Utilities.getSiteUrlRoot=function(){var $0=window.location.protocol+'//'+window.location.hostname;if(window.location.port.toString()!==String.Empty){$0+=':'+window.location.port;}return $0;}
WLQuickApps.Tafiti.Scripting.Utilities.userIsLoggedIn=function(){return ($('signInFrame'));}
WLQuickApps.Tafiti.Scripting.Utilities.hash=function(clearText){return WLQuickApps.Tafiti.Scripting.CryptographyManager.getMD5Hash(clearText.toLowerCase());}
WLQuickApps.Tafiti.Scripting.Constants.createClass('WLQuickApps.Tafiti.Scripting.Constants');WLQuickApps.Tafiti.Scripting.CryptographyManager.createClass('WLQuickApps.Tafiti.Scripting.CryptographyManager');WLQuickApps.Tafiti.Scripting.MessengerManager.createClass('WLQuickApps.Tafiti.Scripting.MessengerManager');WLQuickApps.Tafiti.Scripting.InteropManager.createClass('WLQuickApps.Tafiti.Scripting.InteropManager');WLQuickApps.Tafiti.Scripting.ContactElement.createClass('WLQuickApps.Tafiti.Scripting.ContactElement');WLQuickApps.Tafiti.Scripting.TafitiUserManager.createClass('WLQuickApps.Tafiti.Scripting.TafitiUserManager');WLQuickApps.Tafiti.Scripting.TafitiUpdateMessageFactory.createClass('WLQuickApps.Tafiti.Scripting.TafitiUpdateMessageFactory',Microsoft.Live.Messenger.Messaging.ApplicationMessageFactory);WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage.createClass('WLQuickApps.Tafiti.Scripting.TafitiUpdateMessage',Microsoft.Live.Messenger.Messaging.ApplicationMessage);WLQuickApps.Tafiti.Scripting.MessengerController.createClass('WLQuickApps.Tafiti.Scripting.MessengerController');WLQuickApps.Tafiti.Scripting.Comment.createClass('WLQuickApps.Tafiti.Scripting.Comment');WLQuickApps.Tafiti.Scripting.CommentManager.createClass('WLQuickApps.Tafiti.Scripting.CommentManager');WLQuickApps.Tafiti.Scripting.TafitiUser.createClass('WLQuickApps.Tafiti.Scripting.TafitiUser');WLQuickApps.Tafiti.Scripting.EntryPoint.createClass('WLQuickApps.Tafiti.Scripting.EntryPoint');WLQuickApps.Tafiti.Scripting.ShelfStack.createClass('WLQuickApps.Tafiti.Scripting.ShelfStack');WLQuickApps.Tafiti.Scripting.ShelfStackItem.createClass('WLQuickApps.Tafiti.Scripting.ShelfStackItem');WLQuickApps.Tafiti.Scripting.ShelfStackManager.createClass('WLQuickApps.Tafiti.Scripting.ShelfStackManager');WLQuickApps.Tafiti.Scripting.Utilities.createClass('WLQuickApps.Tafiti.Scripting.Utilities');WLQuickApps.Tafiti.Scripting.Constants.signInFrameID='signInFrame';WLQuickApps.Tafiti.Scripting.Constants.displayPictureUrl='DisplayPictureUrl';WLQuickApps.Tafiti.Scripting.Constants.displayName='DisplayName';WLQuickApps.Tafiti.Scripting.Constants.personalMessage='PersonalMessage';WLQuickApps.Tafiti.Scripting.Constants.status='Status';WLQuickApps.Tafiti.Scripting.Constants.onlineImageUrl='images/online.png';WLQuickApps.Tafiti.Scripting.Constants.offlineImageUrl='images/offline.png';WLQuickApps.Tafiti.Scripting.Constants.cssClassStrong='strong';WLQuickApps.Tafiti.Scripting.Constants.cssClassSubText='subtext';WLQuickApps.Tafiti.Scripting.Constants.cssClassCollapsed='collapsed';WLQuickApps.Tafiti.Scripting.Constants.cssClassExpanded='expanded';WLQuickApps.Tafiti.Scripting.Constants.cssClassEmpty='empty';WLQuickApps.Tafiti.Scripting.Constants.cssPropertyBlock='block';WLQuickApps.Tafiti.Scripting.Constants.cssPropertyInline='inline';WLQuickApps.Tafiti.Scripting.Constants.cssPropertyNone='none';WLQuickApps.Tafiti.Scripting.Constants.tafitiUpdateMessageID='tafitiupdate';WLQuickApps.Tafiti.Scripting.CryptographyManager.$1=null;WLQuickApps.Tafiti.Scripting.MessengerManager.$0=null;WLQuickApps.Tafiti.Scripting.InteropManager.$0=null;WLQuickApps.Tafiti.Scripting.TafitiUserManager.$1=null;WLQuickApps.Tafiti.Scripting.TafitiUserManager.$3=null;WLQuickApps.Tafiti.Scripting.TafitiUserManager.$5=null;WLQuickApps.Tafiti.Scripting.TafitiUserManager.$7=null;WLQuickApps.Tafiti.Scripting.TafitiUserManager.$8=false;WLQuickApps.Tafiti.Scripting.TafitiUserManager.$9=null;WLQuickApps.Tafiti.Scripting.CommentManager.$1=null;WLQuickApps.Tafiti.Scripting.CommentManager.$3=null;WLQuickApps.Tafiti.Scripting.CommentManager.$5=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$0=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$2=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$4=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$6=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$8=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$A=null;WLQuickApps.Tafiti.Scripting.ShelfStackManager.$E=Date.get_now();
// ---- Do not remove this footer ----
// Generated using Script# v0.4.5.0 (http://projects.nikhilk.net)
// -----------------------------------
